@page "/create"
@rendermode InteractiveServer
@inject NavigationManager navigationManager
@inject IStringLocalizer<Resource> Localizer

@using MudBlazor
@using Data
<MudPopoverProvider />

<style>
    .center-form {
    display: flex; /* Enables Flexbox */
    align-items: center; /* Centers content vertically */
    height: 80vh; /* Full viewport height */
    }
</style>

<MudGrid Justify="Justify.Center" Class="center-form"> 
    <MudItem xs="12" sm="6" md="6" lg="6" xxl="6">
        <MudCard Class="pa-5" Elevation="0">
            <MudCardContent>
                <MudText >
                    @Localizer["EnterUsername"]
                </MudText>
                <MudTextField 
                    T="String" 
                    @bind-Value="username"
                    Label="@Localizer["Username"]"
                    Variant="Variant.Outlined" 
                    Margin="Margin.Dense">
                </MudTextField>
                <MudButton 
                    OnClick="CreateUser" 
                    Color="Color.Primary" 
                    Variant="Variant.Outlined" 
                    FullWidth="true">
                    @Localizer["CreateUser"]
                </MudButton>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>
<MudPopover Open="_open" AnchorOrigin="Origin.CenterCenter" TransformOrigin="Origin.CenterCenter">
    <MudText>@Localizer["UsernameAlreadyExists"]</MudText>
    <MudButton OnClick="(() => _open = false)" Color="Color.Error">Close</MudButton>

</MudPopover>
@code {
    private string? username { get; set; }
    private bool _open = false;
    private void CreateUser(){
        if(username is not null) {
            bool created = FileHandler.AddUser(username);
            if(created){
                navigationManager.NavigateTo($"/{username}");
            }
            else {
                _open = true;
            }
        }
        else {
            Console.WriteLine("a");
        }
    }
    private void ToggleOpen() => _open = !_open;

}
