@page "/create"

@rendermode InteractiveServer
@inject NavigationManager navigationManager
@inject IStringLocalizer<Resource> Localizer
@inject DataHandler DataHandler

<MudPopoverProvider />

<style>
    .center-form {
    display: flex; /* Enables Flexbox */
    align-items: center; /* Centers content vertically */
    height: 80vh; /* Full viewport height */
    }
</style>

<MudGrid Justify="Justify.Center" Class="center-form"> 
    <MudItem xs="12" sm="6" md="6" lg="6" xxl="6">
        <MudCard Class="pa-5" Elevation="0">
            <MudCardContent>
                <MudText Typo="Typo.h4" 
                Align="Align.Center">
                    @Localizer["RegisterAccount"]
                </MudText>
                <br>
                <MudTextField T="String"
                @bind-Value="username"
                Label="@Localizer["Username"]"
                Variant="Variant.Outlined"
                Margin="Margin.Dense"
                Required="true"
                RequiredError="@Localizer["RequiredField"]"/>
                <MudButton OnClick="CreateUser"
                Color="Color.Primary"
                Variant="Variant.Outlined"
                FullWidth="true">
                    @Localizer["CreateUser"]
                </MudButton>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>
<MudPopover Open="_open" AnchorOrigin="Origin.CenterCenter" TransformOrigin="Origin.CenterCenter">
    <MudCard Class="p-5" Elevation="1">
        <MudText>@Localizer["UsernameAlreadyExists"]</MudText>
        <br />
        <MudButton OnClick="(() => _open = false)" Color="Color.Error">
            @Localizer["Close"]
        </MudButton>
    </MudCard>

</MudPopover>
@code {
    private string? username { get; set; }
    private bool _open = false;
    /// <summary>
    /// Tries to create a user with the given username.
    /// If successful, navigates to the user's page.
    /// Otherwise, opens a popover indicating the username already exists.
    /// </summary>
    private void CreateUser(){
        if(username is not null) {
            bool created = DataHandler.TryAddUser(username);
            if(created){
                navigationManager.NavigateTo($"/{username}");
            }
            else {
                _open = true;
                username = String.Empty;
            }
        }
    }
    private void ToggleOpen() => _open = !_open;

}
